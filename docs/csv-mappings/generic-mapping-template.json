{
  "broker": "Generic/Other Broker",
  "status": "template",
  "last_updated": "2026-01-16",
  "notes": "Universal template for unsupported brokers. Use this for manual mapping configuration.",
  "positions_csv": {
    "file_pattern": "<your_broker>_positions_*.csv",
    "required_mappings": {
      "symbol": {
        "your_broker_column": "CHANGE_ME",
        "data_type": "string",
        "example": "TSLA",
        "finance_guru_field": "ticker",
        "instructions": "Replace CHANGE_ME with your broker's column name for stock ticker"
      },
      "quantity": {
        "your_broker_column": "CHANGE_ME",
        "data_type": "number",
        "example": "74",
        "finance_guru_field": "shares",
        "instructions": "Replace CHANGE_ME with your broker's column name for number of shares"
      },
      "average_cost_basis": {
        "your_broker_column": "CHANGE_ME",
        "data_type": "currency",
        "example": "$234.19",
        "finance_guru_field": "average_cost_basis",
        "instructions": "Replace CHANGE_ME with your broker's column name for average purchase price"
      }
    },
    "optional_mappings": {
      "current_price": {
        "your_broker_column": "CHANGE_ME_OR_DELETE",
        "data_type": "currency",
        "finance_guru_field": "current_price"
      },
      "current_value": {
        "your_broker_column": "CHANGE_ME_OR_DELETE",
        "data_type": "currency",
        "finance_guru_field": "current_value"
      },
      "total_gain_loss_dollar": {
        "your_broker_column": "CHANGE_ME_OR_DELETE",
        "data_type": "currency",
        "finance_guru_field": "total_gain_loss_dollar"
      },
      "account_type": {
        "your_broker_column": "CHANGE_ME_OR_DELETE",
        "data_type": "string",
        "finance_guru_field": "type",
        "notes": "Cash or Margin"
      }
    },
    "configuration_steps": [
      "1. Export positions CSV from your broker",
      "2. Open CSV in text editor to see column names",
      "3. Copy this template to <broker_name>-mapping.json",
      "4. Replace CHANGE_ME with actual column names from your CSV",
      "5. Delete optional mappings you don't need (or can't find)",
      "6. Save file and run onboarding again"
    ]
  },
  "balances_csv": {
    "file_pattern": "<your_broker>_balances_*.csv",
    "required_mappings": {
      "settled_cash": {
        "your_broker_field": "CHANGE_ME",
        "data_type": "currency",
        "finance_guru_field": "settled_cash",
        "instructions": "Cash available to trade or withdraw"
      },
      "margin_debt": {
        "your_broker_field": "CHANGE_ME_OR_SET_TO_ZERO",
        "data_type": "currency",
        "finance_guru_field": "net_debit",
        "instructions": "Amount owed on margin. Enter 0 if not using margin."
      },
      "total_account_value": {
        "your_broker_field": "CHANGE_ME",
        "data_type": "currency",
        "finance_guru_field": "total_account_value",
        "instructions": "Total value of all holdings + cash - debt"
      }
    },
    "optional_mappings": {
      "buying_power": {
        "your_broker_field": "CHANGE_ME_OR_DELETE",
        "data_type": "currency",
        "finance_guru_field": "buying_power"
      },
      "pending_activity": {
        "your_broker_field": "CHANGE_ME_OR_DELETE",
        "data_type": "currency",
        "finance_guru_field": "pending_activity"
      }
    }
  },
  "data_format_configuration": {
    "csv_delimiter": {
      "value": ",",
      "instructions": "Change to semicolon (;) or tab (\\t) if your CSV uses different delimiter"
    },
    "header_row": {
      "value": 1,
      "instructions": "Row number where column names appear (usually 1)"
    },
    "data_starts_row": {
      "value": 2,
      "instructions": "First row with actual data (usually 2)"
    },
    "encoding": {
      "value": "utf-8",
      "instructions": "Change to 'utf-8-sig' if file has BOM, or 'latin-1' for European formats"
    },
    "decimal_separator": {
      "value": ".",
      "instructions": "Use '.' for US format (1,234.56) or ',' for European format (1.234,56)"
    },
    "thousands_separator": {
      "value": ",",
      "instructions": "Use ',' for US format or '.' for European format"
    },
    "currency_symbol": {
      "value": "$",
      "instructions": "Change to € or £ if needed, or empty string if no symbol"
    },
    "date_format": {
      "value": "MM/DD/YYYY",
      "instructions": "Common formats: MM/DD/YYYY (US), DD/MM/YYYY (EU), YYYY-MM-DD (ISO)"
    }
  },
  "validation_rules": {
    "positions": [
      "Symbol must not be empty",
      "Quantity must be positive number",
      "Average Cost Basis must be positive number"
    ],
    "balances": [
      "Total account value must be positive",
      "If using margin, net debit should be negative"
    ]
  },
  "testing_checklist": [
    "✅ Exported test CSV from broker",
    "✅ Identified all column names",
    "✅ Mapped required fields",
    "✅ Configured data format settings",
    "✅ Tested import with sample data",
    "✅ Verified values appeared correctly in Google Sheets",
    "✅ Checked formulas still intact after import",
    "✅ Confirmed margin debt sign is correct (negative)"
  ],
  "common_issues": {
    "problem_1": {
      "issue": "CSV import fails with encoding error",
      "solution": "Try changing encoding to 'utf-8-sig' or 'latin-1'"
    },
    "problem_2": {
      "issue": "Numbers parsed incorrectly",
      "solution": "Check decimal_separator and thousands_separator settings"
    },
    "problem_3": {
      "issue": "Column not found error",
      "solution": "Open CSV in text editor and verify exact column name (case-sensitive, watch for extra spaces)"
    },
    "problem_4": {
      "issue": "Margin debt shows as positive",
      "solution": "Add sign_conversion: 'negate' to margin_debt mapping"
    },
    "problem_5": {
      "issue": "Dates not parsing",
      "solution": "Verify date_format matches your CSV exactly. Use %m/%d/%Y syntax if needed."
    }
  },
  "example_usage": {
    "scenario": "You use E*TRADE and need to import portfolio",
    "steps": [
      "1. Copy this file to etrade-mapping.json",
      "2. Export positions CSV from E*TRADE",
      "3. Open CSV in text editor - see columns: 'Ticker', 'Qty', 'Avg Price'",
      "4. Update mappings:",
      "   - symbol.your_broker_column: 'Ticker'",
      "   - quantity.your_broker_column: 'Qty'",
      "   - average_cost_basis.your_broker_column: 'Avg Price'",
      "5. Save etrade-mapping.json",
      "6. Run: bd create --title='Add E*TRADE CSV parser' --type=feature",
      "7. Or manually import using mapping template"
    ]
  }
}
